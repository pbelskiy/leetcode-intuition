{
  "questionId": "3848",
  "title": "Analyze Subscription Conversion ",
  "content": "<p>Table: <code>UserActivity</code></p>\n\n<pre>\n+------------------+---------+\n| Column Name      | Type    | \n+------------------+---------+\n| user_id          | int     |\n| activity_date    | date    |\n| activity_type    | varchar |\n| activity_duration| int     |\n+------------------+---------+\n(user_id, activity_date, activity_type) is the unique key for this table.\nactivity_type is one of (&#39;free_trial&#39;, &#39;paid&#39;, &#39;cancelled&#39;).\nactivity_duration is the number of minutes the user spent on the platform that day.\nEach row represents a user&#39;s activity on a specific date.\n</pre>\n\n<p>A subscription service wants to analyze user behavior patterns. The company offers a <code>7</code>-day <strong>free trial</strong>, after which users can subscribe to a <strong>paid plan</strong> or <strong>cancel</strong>. Write a solution to:</p>\n\n<ol>\n\t<li>Find users who converted from free trial to paid subscription</li>\n\t<li>Calculate each user&#39;s <strong>average daily activity duration</strong> during their <strong>free trial</strong> period (rounded to <code>2</code> decimal places)</li>\n\t<li>Calculate each user&#39;s <strong>average daily activity duration</strong> during their <strong>paid</strong> subscription period (rounded to <code>2</code> decimal places)</li>\n</ol>\n\n<p>Return <em>the result table ordered by </em><code>user_id</code><em> in <strong>ascending</strong> order</em>.</p>\n\n<p>The result format is in the following example.</p>\n\n<p>&nbsp;</p>\n<p><strong class=\"example\">Example:</strong></p>\n\n<div class=\"example-block\">\n<p><strong>Input:</strong></p>\n\n<p>UserActivity table:</p>\n\n<pre class=\"example-io\">\n+---------+---------------+---------------+-------------------+\n| user_id | activity_date | activity_type | activity_duration |\n+---------+---------------+---------------+-------------------+\n| 1       | 2023-01-01    | free_trial    | 45                |\n| 1       | 2023-01-02    | free_trial    | 30                |\n| 1       | 2023-01-05    | free_trial    | 60                |\n| 1       | 2023-01-10    | paid          | 75                |\n| 1       | 2023-01-12    | paid          | 90                |\n| 1       | 2023-01-15    | paid          | 65                |\n| 2       | 2023-02-01    | free_trial    | 55                |\n| 2       | 2023-02-03    | free_trial    | 25                |\n| 2       | 2023-02-07    | free_trial    | 50                |\n| 2       | 2023-02-10    | cancelled     | 0                 |\n| 3       | 2023-03-05    | free_trial    | 70                |\n| 3       | 2023-03-06    | free_trial    | 60                |\n| 3       | 2023-03-08    | free_trial    | 80                |\n| 3       | 2023-03-12    | paid          | 50                |\n| 3       | 2023-03-15    | paid          | 55                |\n| 3       | 2023-03-20    | paid          | 85                |\n| 4       | 2023-04-01    | free_trial    | 40                |\n| 4       | 2023-04-03    | free_trial    | 35                |\n| 4       | 2023-04-05    | paid          | 45                |\n| 4       | 2023-04-07    | cancelled     | 0                 |\n+---------+---------------+---------------+-------------------+\n</pre>\n\n<p><strong>Output:</strong></p>\n\n<pre class=\"example-io\">\n+---------+--------------------+-------------------+\n| user_id | trial_avg_duration | paid_avg_duration |\n+---------+--------------------+-------------------+\n| 1       | 45.00              | 76.67             |\n| 3       | 70.00              | 63.33             |\n| 4       | 37.50              | 45.00             |\n+---------+--------------------+-------------------+\n</pre>\n\n<p><strong>Explanation:</strong></p>\n\n<ul>\n\t<li><strong>User 1:</strong>\n\n\t<ul>\n\t\t<li>Had 3 days of free trial with durations of 45, 30, and 60 minutes.</li>\n\t\t<li>Average trial duration: (45 + 30 + 60) / 3 = 45.00 minutes.</li>\n\t\t<li>Had 3 days of paid subscription with durations of 75, 90, and 65 minutes.</li>\n\t\t<li>Average paid duration: (75 + 90 + 65) / 3 = 76.67 minutes.</li>\n\t</ul>\n\t</li>\n\t<li><strong>User 2:</strong>\n\t<ul>\n\t\t<li>Had 3 days of free trial with durations of 55, 25, and 50 minutes.</li>\n\t\t<li>Average trial duration: (55 + 25 + 50) / 3 = 43.33 minutes.</li>\n\t\t<li>Did not convert to a paid subscription (only had free_trial and cancelled activities).</li>\n\t\t<li>Not included in the output because they didn&#39;t convert to paid.</li>\n\t</ul>\n\t</li>\n\t<li><strong>User 3:</strong>\n\t<ul>\n\t\t<li>Had 3 days of free trial with durations of 70, 60, and 80 minutes.</li>\n\t\t<li>Average trial duration: (70 + 60 + 80) / 3 = 70.00 minutes.</li>\n\t\t<li>Had 3 days of paid subscription with durations of 50, 55, and 85 minutes.</li>\n\t\t<li>Average paid duration: (50 + 55 + 85) / 3 = 63.33 minutes.</li>\n\t</ul>\n\t</li>\n\t<li><strong>User 4:</strong>\n\t<ul>\n\t\t<li>Had 2 days of free trial with durations of 40 and 35 minutes.</li>\n\t\t<li>Average trial duration: (40 + 35) / 2 = 37.50 minutes.</li>\n\t\t<li>Had 1 day of paid subscription with duration of 45 minutes before cancelling.</li>\n\t\t<li>Average paid duration: 45.00 minutes.</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p>The result table only includes users who converted from free trial to paid subscription (users 1, 3, and 4), and is ordered by user_id in ascending order.</p>\n</div>\n",
  "difficulty": "Medium",
  "topicTags": [
    {
      "name": "Database",
      "slug": "database"
    }
  ]
}